<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCVB Scoreboard - Contr√¥le</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="control-container">
        <!-- En-t√™te -->
        <div class="control-header">
            <h1>Le Cr√®s Volley-Ball - Panneau de Contr√¥le</h1>
            <div class="obs-warning" id="obs-warning" style="margin-top: 15px; padding: 10px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4CAF50; border-radius: 5px; font-size: 0.9em;">
                <strong>‚úÖ T√©l√©chargement automatique activ√© :</strong> Le fichier <code>data/score-data.json</code> se t√©l√©charge automatiquement √† chaque modification. Copiez-le dans <code>LCVB_Scoreboard/data/</code> pour synchroniser avec OBS.
            </div>
        </div>

        <!-- Grille principale -->
        <div class="control-grid">
            <!-- √âquipe 1 -->
            <div class="control-panel">
                <h2>√âquipe 1</h2>
                
                <!-- Informations de l'√©quipe -->
                <div class="team-info">
                    <div class="input-group">
                        <label for="team1-name">Nom de l'√©quipe :</label>
                        <input type="text" id="team1-name" placeholder="Nom √©quipe 1">
                    </div>
                    <div class="input-group">
                        <label for="team1-niveau">Niveau de l'√©quipe :</label>
                        <select id="team1-niveau" class="niveau-select">
                            <option value="">-- Aucun niveau --</option>
                            <option value="Loisirs">Loisirs</option>
                            <option value="D√©partemental 1">D√©partemental 1</option>
                            <option value="D√©partemental 2">D√©partemental 2</option>
                            <option value="D√©partemental 3">D√©partemental 3</option>
                            <option value="R√©gional 1">R√©gional 1</option>
                            <option value="R√©gional 2">R√©gional 2</option>
                            <option value="R√©gional 3">R√©gional 3</option>
                            <option value="Pr√©national">Pr√©national</option>
                            <option value="National 1">National 1</option>
                            <option value="National 2">National 2</option>
                            <option value="National 3">National 3</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="team1-logo">Chemin du logo :</label>
                        <div class="logo-selector">
                            <input type="file" 
                                   id="team1-logo-file" 
                                   accept="image/*" 
                                   class="logo-file-input"
                                   onchange="handleLogoFileSelect('team1', this)">
                            <input type="text" 
                                   id="team1-logo" 
                                   placeholder="logos/logo-lcvb.png"
                                   class="logo-path-input">
                            <button type="button" 
                                    class="btn btn-logo-browse" 
                                    onclick="document.getElementById('team1-logo-file').click()">
                                üìÅ Parcourir
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Contr√¥les de score -->
                <div class="score-controls">
                    <div class="score-row">
                        <span class="score-label">Score :</span>
                        <input type="number" 
                               id="team1-score-input" 
                               class="score-input" 
                               min="0" 
                               max="999" 
                               value="0"
                               onchange="setScoreDirect('team1', this.value)"
                               oninput="validateScoreInput(this)">
                        <button class="btn btn-plus" onclick="changeScore('team1', 1)">+</button>
                        <button class="btn btn-minus" onclick="changeScore('team1', -1)">‚àí</button>
                    </div>
                    <button class="btn btn-reset" onclick="resetScore('team1')">R√©initialiser Score</button>
                </div>

                <!-- Contr√¥les des sets -->
                <div class="sets-controls">
                    <h3 style="color: var(--lcvb-rose); margin-top: 20px; margin-bottom: 10px;">Sets :</h3>
                    <div id="team1-sets-controls">
                        <!-- G√©n√©r√©s dynamiquement -->
                    </div>
                </div>
            </div>

            <!-- √âquipe 2 -->
            <div class="control-panel">
                <h2>√âquipe 2</h2>
                
                <!-- Informations de l'√©quipe -->
                <div class="team-info">
                    <div class="input-group">
                        <label for="team2-name">Nom de l'√©quipe :</label>
                        <input type="text" id="team2-name" placeholder="Nom √©quipe 2">
                    </div>
                    <div class="input-group">
                        <label for="team2-niveau">Niveau de l'√©quipe :</label>
                        <select id="team2-niveau" class="niveau-select">
                            <option value="">-- Aucun niveau --</option>
                            <option value="Loisirs">Loisirs</option>
                            <option value="D√©partemental 1">D√©partemental 1</option>
                            <option value="D√©partemental 2">D√©partemental 2</option>
                            <option value="D√©partemental 3">D√©partemental 3</option>
                            <option value="R√©gional 1">R√©gional 1</option>
                            <option value="R√©gional 2">R√©gional 2</option>
                            <option value="R√©gional 3">R√©gional 3</option>
                            <option value="Pr√©national">Pr√©national</option>
                            <option value="National 1">National 1</option>
                            <option value="National 2">National 2</option>
                            <option value="National 3">National 3</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="team2-logo">Chemin du logo :</label>
                        <div class="logo-selector">
                            <input type="file" 
                                   id="team2-logo-file" 
                                   accept="image/*" 
                                   class="logo-file-input"
                                   onchange="handleLogoFileSelect('team2', this)">
                            <input type="text" 
                                   id="team2-logo" 
                                   placeholder="logos/logo-equipe2.png"
                                   class="logo-path-input">
                            <button type="button" 
                                    class="btn btn-logo-browse" 
                                    onclick="document.getElementById('team2-logo-file').click()">
                                üìÅ Parcourir
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Contr√¥les de score -->
                <div class="score-controls">
                    <div class="score-row">
                        <span class="score-label">Score :</span>
                        <input type="number" 
                               id="team2-score-input" 
                               class="score-input" 
                               min="0" 
                               max="999" 
                               value="0"
                               onchange="setScoreDirect('team2', this.value)"
                               oninput="validateScoreInput(this)">
                        <button class="btn btn-plus" onclick="changeScore('team2', 1)">+</button>
                        <button class="btn btn-minus" onclick="changeScore('team2', -1)">‚àí</button>
                    </div>
                    <button class="btn btn-reset" onclick="resetScore('team2')">R√©initialiser Score</button>
                </div>

                <!-- Contr√¥les des sets -->
                <div class="sets-controls">
                    <h3 style="color: var(--lcvb-rose); margin-top: 20px; margin-bottom: 10px;">Sets :</h3>
                    <div id="team2-sets-controls">
                        <!-- G√©n√©r√©s dynamiquement -->
                    </div>
                </div>
            </div>

            <!-- Contr√¥les globaux -->
            <div class="global-controls">
                <div class="match-type-selector">
                    <label for="match-amical" style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; background: rgba(233, 30, 99, 0.1); border-radius: 5px; border: 2px solid var(--lcvb-rose);">
                        <input type="checkbox" 
                               id="match-amical" 
                               onchange="updateMatchAmicalCommon(this.checked)"
                               style="width: auto; margin: 0;">
                        <strong>Match amical</strong>
                    </label>
                </div>
                <div class="set-selector">
                    <label for="set-selector">Set actuel :</label>
                    <select id="set-selector" onchange="changeCurrentSet()">
                        <option value="1">Set 1</option>
                        <option value="2">Set 2</option>
                        <option value="3">Set 3</option>
                        <option value="4">Set 4</option>
                        <option value="5">Set 5</option>
                    </select>
                </div>
                <div class="template-selector">
                    <label for="template-selector">Style :</label>
                    <select id="template-selector" onchange="changeTemplateMode(this.value)" title="Choisir le style d'affichage">
                        <option value="actuel">Actuel (Club - Rose/Noir)</option>
                        <option value="neutre">Neutre (Minimaliste)</option>
                        <option value="sobre">Sobre (Couleurs adoucies)</option>
                        <option value="pro">Pro (Style professionnel)</option>
                        <option value="custom">Couleurs personnalis√©es</option>
                    </select>
                </div>
                <div id="custom-colors-panel" class="custom-colors-panel" style="display: none;">
                    <div class="colors-grid">
                        <div class="color-item">
                            <label for="color-primary">Couleur principale :</label>
                            <input type="color" id="color-primary" value="#E91E63" onchange="updateCustomColor('primary', this.value)">
                            <span class="color-desc">(Scores, bordures, accents)</span>
                        </div>
                        <div class="color-item">
                            <label for="color-secondary">Couleur secondaire :</label>
                            <input type="color" id="color-secondary" value="#FF69B4" onchange="updateCustomColor('secondary', this.value)">
                            <span class="color-desc">(Niveaux, accents clairs)</span>
                        </div>
                        <div class="color-item">
                            <label for="color-background">Fond principal :</label>
                            <input type="color" id="color-background" value="#000000" onchange="updateCustomColor('background', this.value)">
                            <span class="color-desc">(Background du bandeau)</span>
                        </div>
                        <div class="color-item">
                            <label for="color-background-secondary">Fond secondaire :</label>
                            <input type="color" id="color-background-secondary" value="#0f0f0f" onchange="updateCustomColor('backgroundSecondary', this.value)">
                            <span class="color-desc">(Gradient de fond)</span>
                        </div>
                        <div class="color-item">
                            <label for="color-text">Couleur du texte :</label>
                            <input type="color" id="color-text" value="#FFFFFF" onchange="updateCustomColor('text', this.value)">
                            <span class="color-desc">(Noms, textes)</span>
                        </div>
                        <div class="color-item">
                            <label for="color-set-active">Sets actifs :</label>
                            <input type="color" id="color-set-active" value="#E91E63" onchange="updateCustomColor('setActive', this.value)">
                            <span class="color-desc">(Sets gagn√©s/actifs)</span>
                        </div>
                    </div>
                    <div class="save-config-section">
                        <input type="text" id="config-name-input" placeholder="Nom de la configuration..." maxlength="30" style="padding: 8px; border-radius: 5px; border: 1px solid var(--lcvb-rose); background: var(--lcvb-noir); color: var(--lcvb-blanc); margin-right: 10px;">
                        <button class="btn btn-save-config" onclick="saveConfig()">üíæ Sauvegarder</button>
                        <select id="load-config-select" onchange="loadConfig(this.value)" style="padding: 8px; border-radius: 5px; border: 1px solid var(--lcvb-rose); background: var(--lcvb-noir); color: var(--lcvb-blanc); margin-left: 10px;">
                            <option value="">Charger une configuration...</option>
                        </select>
                        <button class="btn btn-delete-config" onclick="deleteCurrentConfig()" style="margin-left: 10px; padding: 8px 15px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">üóëÔ∏è Supprimer</button>
                    </div>
                </div>
                <div class="match-info-panel" style="grid-column: 1 / -1; background: rgba(233, 30, 99, 0.1); padding: 20px; border-radius: 10px; border: 2px solid var(--lcvb-rose); margin: 10px 0;">
                    <h3 style="color: var(--lcvb-rose); margin-bottom: 15px; text-align: center;">üìã Informations du Match</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="input-group">
                            <label for="match-date">Date du match :</label>
                            <input type="date" id="match-date" onchange="updateMatchInfo('date', this.value)" style="padding: 10px; border: 2px solid var(--lcvb-rose); border-radius: 5px; background: var(--lcvb-noir); color: var(--lcvb-blanc);">
                        </div>
                        <div class="input-group">
                            <label for="match-time">Heure du match :</label>
                            <input type="time" id="match-time" onchange="updateMatchInfo('time', this.value)" style="padding: 10px; border: 2px solid var(--lcvb-rose); border-radius: 5px; background: var(--lcvb-noir); color: var(--lcvb-blanc);">
                        </div>
                        <div class="input-group">
                            <label for="match-location">Lieu :</label>
                            <input type="text" id="match-location" placeholder="Ex: Salle des sports" onchange="updateMatchInfo('location', this.value)" style="padding: 10px; border: 2px solid var(--lcvb-rose); border-radius: 5px; background: var(--lcvb-noir); color: var(--lcvb-blanc);">
                        </div>
                        <div class="input-group">
                            <label for="match-competition">Comp√©tition :</label>
                            <input type="text" id="match-competition" placeholder="Ex: Championnat, Coupe..." onchange="updateMatchInfo('competition', this.value)" style="padding: 10px; border: 2px solid var(--lcvb-rose); border-radius: 5px; background: var(--lcvb-noir); color: var(--lcvb-blanc);">
                        </div>
                        <div class="input-group">
                            <label for="match-referee">Arbitre :</label>
                            <input type="text" id="match-referee" placeholder="Nom de l'arbitre" onchange="updateMatchInfo('referee', this.value)" style="padding: 10px; border: 2px solid var(--lcvb-rose); border-radius: 5px; background: var(--lcvb-noir); color: var(--lcvb-blanc);">
                        </div>
                        <div class="input-group">
                            <label for="match-notes">Notes :</label>
                            <input type="text" id="match-notes" placeholder="Notes suppl√©mentaires" onchange="updateMatchInfo('notes', this.value)" style="padding: 10px; border: 2px solid var(--lcvb-rose); border-radius: 5px; background: var(--lcvb-noir); color: var(--lcvb-blanc);">
                        </div>
                    </div>
                </div>
                <button class="btn btn-next-set" onclick="nextSet()">Set Suivant</button>
                <button class="btn btn-undo" id="btn-undo" onclick="undoAction()" title="Annuler la derni√®re action (Ctrl+Z)">‚Ü∂ Annuler</button>
                <button class="btn btn-toggle-logos" id="toggle-logos-btn" onclick="toggleLogos()" title="Afficher/Masquer les logos">üñºÔ∏è Logos</button>
                <button class="btn btn-social" onclick="showSocialShare()" title="Publier sur les r√©seaux sociaux">üì± Publier</button>
                <button class="btn btn-full-reset" onclick="resetEverything()">R√©initialiser Tout</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Initialisation
        LCVBScoreboard.initScoreData();

        // Fonction pour mettre √† jour l'affichage
        function updateDisplay() {
            const data = LCVBScoreboard.getScoreData();
            
            // Mise √† jour des champs de noms
            document.getElementById('team1-name').value = data.team1.name;
            document.getElementById('team2-name').value = data.team2.name;
            
            // Mise √† jour des champs de niveaux
            document.getElementById('team1-niveau').value = data.team1.niveau || '';
            document.getElementById('team2-niveau').value = data.team2.niveau || '';
            
            // Mise √† jour du checkbox "Match amical" (commun)
            const matchAmical = document.getElementById('match-amical');
            if (matchAmical) {
                matchAmical.checked = data.matchAmical === true;
            }
            
            // Mise √† jour du s√©lecteur de template
            const templateSelector = document.getElementById('template-selector');
            if (templateSelector) {
                const template = data.template || 'actuel';
                templateSelector.value = template;
                
                // G√©rer l'affichage du panneau de couleurs personnalis√©es
                const customPanel = document.getElementById('custom-colors-panel');
                if (template === 'custom') {
                    customPanel.style.display = 'flex';
                    const colors = data.customColors || {};
                    document.getElementById('color-primary').value = colors.primary || '#E91E63';
                    document.getElementById('color-secondary').value = colors.secondary || '#FF69B4';
                    document.getElementById('color-background').value = colors.background || '#000000';
                    document.getElementById('color-background-secondary').value = colors.backgroundSecondary || '#0f0f0f';
                    document.getElementById('color-text').value = colors.text || '#FFFFFF';
                    document.getElementById('color-set-active').value = colors.setActive || '#E91E63';
                    applyCustomColors();
                    updateConfigSelect();
                } else {
                    customPanel.style.display = 'none';
                    // Appliquer le template
                    document.body.className = document.body.className.replace(/template-\w+/g, '');
                    document.body.classList.add(`template-${template}`);
                }
            }
            
            // Mettre √† jour le s√©lecteur de configurations
            updateConfigSelect();
            
            // Mise √† jour des champs de logos
            document.getElementById('team1-logo').value = data.team1.logo;
            document.getElementById('team2-logo').value = data.team2.logo;
            
            // Mise √† jour du bouton toggle logos
            const toggleLogosBtn = document.getElementById('toggle-logos-btn');
            if (toggleLogosBtn) {
                const showLogos = data.showLogos !== false;
                toggleLogosBtn.textContent = showLogos ? 'üñºÔ∏è Masquer Logos' : 'üñºÔ∏è Afficher Logos';
                toggleLogosBtn.classList.toggle('btn-toggle-logos-off', !showLogos);
            }
            
            // Mise √† jour des scores (v√©rifier que les inputs existent et ne sont pas en focus)
            const score1Input = document.getElementById('team1-score-input');
            const score2Input = document.getElementById('team2-score-input');
            if (score1Input && document.activeElement !== score1Input && score1Input.value != data.team1.score) {
                score1Input.value = data.team1.score;
            }
            if (score2Input && document.activeElement !== score2Input && score2Input.value != data.team2.score) {
                score2Input.value = data.team2.score;
            }
            
            // Mise √† jour du s√©lecteur de set
            document.getElementById('set-selector').value = data.currentSet;
            
            // Mise √† jour des informations du match
            const matchInfo = data.matchInfo || {};
            const matchDateInput = document.getElementById('match-date');
            const matchTimeInput = document.getElementById('match-time');
            const matchLocationInput = document.getElementById('match-location');
            const matchCompetitionInput = document.getElementById('match-competition');
            const matchRefereeInput = document.getElementById('match-referee');
            const matchNotesInput = document.getElementById('match-notes');
            
            if (matchDateInput) matchDateInput.value = matchInfo.date || '';
            if (matchTimeInput) matchTimeInput.value = matchInfo.time || '';
            if (matchLocationInput) matchLocationInput.value = matchInfo.location || '';
            if (matchCompetitionInput) matchCompetitionInput.value = matchInfo.competition || '';
            if (matchRefereeInput) matchRefereeInput.value = matchInfo.referee || '';
            if (matchNotesInput) matchNotesInput.value = matchInfo.notes || '';
            
            // Mise √† jour du bouton Undo (actif/inactif selon l'historique)
            const undoBtn = document.getElementById('btn-undo');
            if (undoBtn) {
                const hasHistory = data.history && data.history.length > 0 && data.historyIndex >= 0;
                undoBtn.disabled = !hasHistory;
                undoBtn.style.opacity = hasHistory ? '1' : '0.5';
                undoBtn.style.cursor = hasHistory ? 'pointer' : 'not-allowed';
            }
            
            // Mise √† jour des contr√¥les de sets
            updateSetsControls();
        }

        // Fonction pour mettre √† jour les contr√¥les de sets
        function updateSetsControls() {
            const data = LCVBScoreboard.getScoreData();
            const team1Controls = document.getElementById('team1-sets-controls');
            const team2Controls = document.getElementById('team2-sets-controls');
            
            team1Controls.innerHTML = '';
            team2Controls.innerHTML = '';
            
            for (let i = 0; i < data.maxSets; i++) {
                const setNum = i + 1;
                
                // Contr√¥les √©quipe 1
                const row1 = document.createElement('div');
                row1.className = 'sets-row';
                
                const label1 = document.createElement('span');
                label1.className = 'set-label';
                label1.textContent = `Set ${setNum} :`;
                
                const input1 = document.createElement('input');
                input1.type = 'number';
                input1.id = `team1-set${setNum}-input`;
                input1.className = 'set-input';
                input1.min = '0';
                input1.max = '99';
                input1.value = data.team1.sets[i] || 0;
                input1.addEventListener('change', () => setSetDirect('team1', i, input1.value));
                input1.addEventListener('input', () => validateSetInput(input1));
                
                const plus1 = document.createElement('button');
                plus1.className = 'btn btn-plus';
                plus1.style.cssText = 'padding: 10px 15px; font-size: 1em;';
                plus1.textContent = '+';
                plus1.onclick = () => changeSet('team1', i, 1);
                
                const minus1 = document.createElement('button');
                minus1.className = 'btn btn-minus';
                minus1.style.cssText = 'padding: 10px 15px; font-size: 1em;';
                minus1.textContent = '‚àí';
                minus1.onclick = () => changeSet('team1', i, -1);
                
                row1.appendChild(label1);
                row1.appendChild(input1);
                row1.appendChild(plus1);
                row1.appendChild(minus1);
                team1Controls.appendChild(row1);
                
                // Contr√¥les √©quipe 2
                const row2 = document.createElement('div');
                row2.className = 'sets-row';
                
                const label2 = document.createElement('span');
                label2.className = 'set-label';
                label2.textContent = `Set ${setNum} :`;
                
                const input2 = document.createElement('input');
                input2.type = 'number';
                input2.id = `team2-set${setNum}-input`;
                input2.className = 'set-input';
                input2.min = '0';
                input2.max = '99';
                input2.value = data.team2.sets[i] || 0;
                input2.addEventListener('change', () => setSetDirect('team2', i, input2.value));
                input2.addEventListener('input', () => validateSetInput(input2));
                
                const plus2 = document.createElement('button');
                plus2.className = 'btn btn-plus';
                plus2.style.cssText = 'padding: 10px 15px; font-size: 1em;';
                plus2.textContent = '+';
                plus2.onclick = () => changeSet('team2', i, 1);
                
                const minus2 = document.createElement('button');
                minus2.className = 'btn btn-minus';
                minus2.style.cssText = 'padding: 10px 15px; font-size: 1em;';
                minus2.textContent = '‚àí';
                minus2.onclick = () => changeSet('team2', i, -1);
                
                row2.appendChild(label2);
                row2.appendChild(input2);
                row2.appendChild(plus2);
                row2.appendChild(minus2);
                team2Controls.appendChild(row2);
            }
        }

        // Fonction pour changer le score avec les boutons +/-
        function changeScore(team, delta) {
            LCVBScoreboard.updateScore(team, delta);
            updateDisplay();
        }
        
        // Fonction pour d√©finir le score directement via input
        function setScoreDirect(team, value) {
            const score = parseInt(value) || 0;
            const data = LCVBScoreboard.getScoreData();
            const oldData = JSON.parse(JSON.stringify(data)); // Sauvegarder l'√©tat avant
            data[team].score = Math.max(0, Math.min(999, score));
            
            // Ajouter √† l'historique
            LCVBScoreboard.addToHistory('setScoreDirect', oldData, data, { team: team, score: score });
            
            LCVBScoreboard.saveScoreData(data);
            updateDisplay();
        }
        
        // Validation de l'input de score
        function validateScoreInput(input) {
            let value = parseInt(input.value);
            if (isNaN(value) || value < 0) {
                value = 0;
            }
            if (value > 999) {
                value = 999;
            }
            input.value = value;
        }

        // Fonction pour r√©initialiser le score d'une √©quipe
        function resetScore(team) {
            const data = LCVBScoreboard.getScoreData();
            data[team].score = 0;
            LCVBScoreboard.saveScoreData(data);
            updateDisplay();
        }

        // Fonction pour changer le set avec les boutons +/-
        function changeSet(team, setIndex, delta) {
            LCVBScoreboard.updateSet(team, setIndex, delta);
            // Mettre √† jour l'input directement pour feedback imm√©diat
            const data = LCVBScoreboard.getScoreData();
            const input = document.getElementById(`${team}-set${setIndex + 1}-input`);
            if (input && document.activeElement !== input) {
                input.value = data[team].sets[setIndex] || 0;
            }
            updateDisplay();
        }
        
        // Fonction pour d√©finir le set directement via input
        function setSetDirect(team, setIndex, value) {
            const score = parseInt(value) || 0;
            const data = LCVBScoreboard.getScoreData();
            const oldData = JSON.parse(JSON.stringify(data)); // Sauvegarder l'√©tat avant
            data[team].sets[setIndex] = Math.max(0, Math.min(99, score));
            
            // Ajouter √† l'historique
            LCVBScoreboard.addToHistory('setSetDirect', oldData, data, { team: team, setIndex: setIndex, score: score });
            
            LCVBScoreboard.saveScoreData(data);
            updateDisplay();
        }
        
        // Validation de l'input de set
        function validateSetInput(input) {
            let value = parseInt(input.value);
            if (isNaN(value) || value < 0) {
                value = 0;
            }
            if (value > 99) {
                value = 99;
            }
            input.value = value;
        }

        // Fonction pour changer le set actuel
        function changeCurrentSet() {
            const setNum = parseInt(document.getElementById('set-selector').value);
            const data = LCVBScoreboard.getScoreData();
            
            // Sauvegarder les scores du set actuel avant de changer
            const currentSetIndex = data.currentSet - 1;
            data.team1.sets[currentSetIndex] = data.team1.score;
            data.team2.sets[currentSetIndex] = data.team2.score;
            LCVBScoreboard.saveScoreData(data);
            
            // Charger les scores du nouveau set si disponible
            const newSetIndex = setNum - 1;
            if (data.team1.sets[newSetIndex] > 0 || data.team2.sets[newSetIndex] > 0) {
                // Le set a d√©j√† √©t√© jou√©, on charge les scores sauvegard√©s
                data.team1.score = data.team1.sets[newSetIndex];
                data.team2.score = data.team2.sets[newSetIndex];
            } else {
                // Nouveau set, on r√©initialise
                data.team1.score = 0;
                data.team2.score = 0;
            }
            
            LCVBScoreboard.changeSet(setNum);
            updateDisplay();
        }

        // Fonction pour passer au set suivant
        function nextSet() {
            LCVBScoreboard.nextSet();
            updateDisplay();
        }

        // Fonction pour annuler la derni√®re action
        function undoAction() {
            const result = LCVBScoreboard.undoLastAction();
            if (result) {
                updateDisplay();
            } else {
                alert('Aucune action √† annuler');
            }
        }

        // Fonction pour r√©initialiser tout
        function resetEverything() {
            if (confirm('√ätes-vous s√ªr de vouloir tout r√©initialiser ?')) {
                LCVBScoreboard.resetAll();
                updateDisplay();
            }
        }
        
        // Fonction pour toggle l'affichage des logos
        function toggleLogos() {
            LCVBScoreboard.toggleShowLogos();
            updateDisplay();
        }
        
        // Fonction pour mettre √† jour le flag "Match amical" (commun)
        function updateMatchAmicalCommon(isAmical) {
            LCVBScoreboard.updateMatchAmicalCommon(isAmical);
            updateDisplay();
        }

        // Fonction pour mettre √† jour les informations du match
        function updateMatchInfo(field, value) {
            LCVBScoreboard.updateMatchInfo(field, value);
            updateDisplay();
        }

        // Fonction pour afficher la modal de partage r√©seaux sociaux
        function showSocialShare() {
            const modal = document.getElementById('social-modal');
            if (modal) {
                modal.style.display = 'block';
            }
        }

        // Fonction pour fermer la modal
        function closeSocialModal() {
            const modal = document.getElementById('social-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Fermer la modal en cliquant en dehors
        window.onclick = function(event) {
            const modal = document.getElementById('social-modal');
            if (event.target === modal) {
                closeSocialModal();
            }
        }

        // Fonction pour changer le mode (template ou custom)
        function changeTemplateMode(mode) {
            const data = LCVBScoreboard.getScoreData();
            data.template = mode;
            LCVBScoreboard.saveScoreData(data);
            
            // Afficher/masquer le panneau de couleurs personnalis√©es
            const customPanel = document.getElementById('custom-colors-panel');
            if (mode === 'custom') {
                customPanel.style.display = 'flex';
                // Charger toutes les couleurs actuelles
                const colors = data.customColors || {};
                document.getElementById('color-primary').value = colors.primary || '#E91E63';
                document.getElementById('color-secondary').value = colors.secondary || '#FF69B4';
                document.getElementById('color-background').value = colors.background || '#000000';
                document.getElementById('color-background-secondary').value = colors.backgroundSecondary || '#0f0f0f';
                document.getElementById('color-text').value = colors.text || '#FFFFFF';
                document.getElementById('color-set-active').value = colors.setActive || '#E91E63';
                applyCustomColors();
                updateConfigSelect();
            } else {
                customPanel.style.display = 'none';
                // Appliquer le template √† la page courante
                document.body.className = document.body.className.replace(/template-\w+/g, '');
                document.body.classList.add(`template-${mode}`);
                // Si c'est le template PRO, pas besoin d'appliquer ici car c'est g√©r√© dans index.html
            }
        }

        // Fonction pour mettre √† jour les couleurs personnalis√©es
        function updateCustomColor(type, color) {
            const data = LCVBScoreboard.getScoreData();
            if (!data.customColors) {
                data.customColors = {
                    primary: '#E91E63',
                    secondary: '#FF69B4',
                    background: '#000000',
                    backgroundSecondary: '#0f0f0f',
                    text: '#FFFFFF',
                    setActive: '#E91E63'
                };
            }
            data.customColors[type] = color;
            data.template = 'custom';
            LCVBScoreboard.saveScoreData(data);
            applyCustomColors();
        }

        // Fonction pour appliquer les couleurs personnalis√©es
        function applyCustomColors() {
            const data = LCVBScoreboard.getScoreData();
            if (data.template !== 'custom' || !data.customColors) return;
            
            const colors = data.customColors;
            const primary = colors.primary || '#E91E63';
            const secondary = colors.secondary || '#FF69B4';
            const background = colors.background || '#000000';
            const backgroundSecondary = colors.backgroundSecondary || '#0f0f0f';
            const text = colors.text || '#FFFFFF';
            const setActive = colors.setActive || '#E91E63';
            
            // Convertir hex en RGB
            function hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '233, 30, 99';
            }
            
            const primaryRgb = hexToRgb(primary);
            const backgroundRgb = hexToRgb(background);
            const backgroundSecondaryRgb = hexToRgb(backgroundSecondary);
            
            // Appliquer le template custom et d√©finir les variables CSS
            document.body.className = document.body.className.replace(/template-\w+/g, '');
            document.body.classList.add('template-custom');
            
            // D√©finir toutes les variables CSS dynamiquement
            document.documentElement.style.setProperty('--template-primary', primary);
            document.documentElement.style.setProperty('--template-primary-light', secondary);
            document.documentElement.style.setProperty('--template-primary-rgb', primaryRgb);
            document.documentElement.style.setProperty('--template-border', primary);
            document.documentElement.style.setProperty('--template-accent', primary);
            document.documentElement.style.setProperty('--template-bg', background);
            document.documentElement.style.setProperty('--template-bg-gradient', `linear-gradient(180deg, ${background} 0%, ${backgroundSecondary} 100%)`);
            document.documentElement.style.setProperty('--template-text', text);
            
            // Variable pour les sets actifs (utilis√©e dans .set-badge.active)
            const style = document.createElement('style');
            style.id = 'custom-colors-style';
            if (document.getElementById('custom-colors-style')) {
                document.getElementById('custom-colors-style').remove();
            }
            style.textContent = `
                body.template-custom .set-badge.active,
                body.template-custom .set-badge.won {
                    background: ${setActive};
                    border-color: ${setActive};
                }
            `;
            document.head.appendChild(style);
        }

        // Fonction pour sauvegarder la configuration actuelle
        function saveConfig() {
            const nameInput = document.getElementById('config-name-input');
            const configName = nameInput.value.trim();
            
            if (!configName) {
                alert('Veuillez entrer un nom pour la configuration');
                return;
            }
            
            const data = LCVBScoreboard.getScoreData();
            if (!data.savedConfigs) {
                data.savedConfigs = {};
            }
            
            // Sauvegarder la configuration actuelle
            data.savedConfigs[configName] = {
                customColors: JSON.parse(JSON.stringify(data.customColors || {})),
                template: 'custom',
                savedAt: new Date().toISOString()
            };
            
            LCVBScoreboard.saveScoreData(data);
            nameInput.value = '';
            updateConfigSelect();
            alert(`Configuration "${configName}" sauvegard√©e avec succ√®s !`);
        }

        // Fonction pour charger une configuration sauvegard√©e
        function loadConfig(configName) {
            if (!configName) return;
            
            const data = LCVBScoreboard.getScoreData();
            if (!data.savedConfigs || !data.savedConfigs[configName]) {
                alert('Configuration introuvable');
                return;
            }
            
            const config = data.savedConfigs[configName];
            data.customColors = JSON.parse(JSON.stringify(config.customColors));
            data.template = 'custom';
            LCVBScoreboard.saveScoreData(data);
            
            // Mettre √† jour les inputs
            document.getElementById('color-primary').value = data.customColors.primary || '#E91E63';
            document.getElementById('color-secondary').value = data.customColors.secondary || '#FF69B4';
            document.getElementById('color-background').value = data.customColors.background || '#000000';
            document.getElementById('color-background-secondary').value = data.customColors.backgroundSecondary || '#0f0f0f';
            document.getElementById('color-text').value = data.customColors.text || '#FFFFFF';
            document.getElementById('color-set-active').value = data.customColors.setActive || '#E91E63';
            
            applyCustomColors();
            updateDisplay();
        }

        // Fonction pour supprimer la configuration actuellement s√©lectionn√©e
        function deleteCurrentConfig() {
            const select = document.getElementById('load-config-select');
            const configName = select.value;
            
            if (!configName) {
                alert('Aucune configuration s√©lectionn√©e');
                return;
            }
            
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer la configuration "${configName}" ?`)) {
                return;
            }
            
            const data = LCVBScoreboard.getScoreData();
            if (data.savedConfigs && data.savedConfigs[configName]) {
                delete data.savedConfigs[configName];
                LCVBScoreboard.saveScoreData(data);
                updateConfigSelect();
                select.value = '';
                alert(`Configuration "${configName}" supprim√©e`);
            }
        }

        // Fonction pour mettre √† jour le s√©lecteur de configurations
        function updateConfigSelect() {
            const select = document.getElementById('load-config-select');
            const data = LCVBScoreboard.getScoreData();
            const savedConfigs = data.savedConfigs || {};
            
            // Garder l'option par d√©faut
            const defaultOption = select.querySelector('option[value=""]');
            select.innerHTML = '';
            select.appendChild(defaultOption);
            
            // Ajouter toutes les configurations sauvegard√©es
            Object.keys(savedConfigs).sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }

        // Fonction pour changer le template (ancienne fonction, gard√©e pour compatibilit√©)
        function changeTemplate(templateName) {
            changeTemplateMode(templateName);
        }
        
        // √âcouter les changements des champs de nom
        document.getElementById('team1-name').addEventListener('input', function() {
            LCVBScoreboard.updateTeamName('team1', this.value);
        });

        document.getElementById('team2-name').addEventListener('input', function() {
            LCVBScoreboard.updateTeamName('team2', this.value);
        });
        
        // √âcouter les changements des champs de niveau (select)
        document.getElementById('team1-niveau').addEventListener('change', function() {
            LCVBScoreboard.updateTeamNiveau('team1', this.value);
        });

        document.getElementById('team2-niveau').addEventListener('change', function() {
            LCVBScoreboard.updateTeamNiveau('team2', this.value);
        });

        // Fonction pour g√©rer la s√©lection de fichier logo
        function handleLogoFileSelect(team, fileInput) {
            const file = fileInput.files[0];
            if (file) {
                // Cr√©er une URL locale pour l'image
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Utiliser l'URL du fichier pour l'affichage imm√©diat
                    const logoPath = `logos/${file.name}`;
                    const logoInput = document.getElementById(`${team}-logo`);
                    
                    // Mettre √† jour le champ texte
                    logoInput.value = logoPath;
                    
                    // Sauvegarder dans localStorage
                    LCVBScoreboard.updateTeamLogo(team, logoPath);
                    
                    // Note: Pour que √ßa fonctionne vraiment, vous devez copier le fichier 
                    // dans le dossier logos manuellement ou utiliser un serveur local
                    alert(`Logo s√©lectionn√©: ${file.name}\n\nPour que le logo s'affiche correctement, copiez le fichier dans le dossier "logos/" et renommez-le si n√©cessaire.\n\nChemin sugg√©r√©: logos/${file.name}`);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // √âcouter les changements des champs de logo (saisie manuelle)
        document.getElementById('team1-logo').addEventListener('input', function() {
            LCVBScoreboard.updateTeamLogo('team1', this.value);
        });

        document.getElementById('team2-logo').addEventListener('input', function() {
            LCVBScoreboard.updateTeamLogo('team2', this.value);
        });

        // Mise √† jour initiale
        updateDisplay();

        // Surveiller les changements localStorage (pour synchronisation multi-fen√™tres)
        let lastControlHash = '';
        setInterval(() => {
            const currentHash = JSON.stringify(LCVBScoreboard.getScoreData());
            if (currentHash !== lastControlHash) {
                lastControlHash = currentHash;
                updateDisplay();
            }
        }, 100);
        
        // Pour les changements depuis une autre fen√™tre/onglet
        window.addEventListener('storage', (e) => {
            if (e.key === 'lcvb_score') {
                lastControlHash = '';
                updateDisplay();
            }
        });
    </script>

    <!-- Modal pour le partage r√©seaux sociaux -->
    <div id="social-modal" class="social-modal">
        <div class="social-modal-content">
            <div class="social-modal-header">
                <h2>üì± Publier sur les r√©seaux sociaux</h2>
                <span class="social-close" onclick="closeSocialModal()">&times;</span>
            </div>
            
            <div class="social-platforms">
                <!-- Instagram -->
                <div class="social-platform">
                    <h3>üì∑ Instagram</h3>
                    <p><strong>Stories :</strong></p>
                    <p>1. Lancez votre live sur Instagram</p>
                    <p>2. Utilisez l'option "Ajouter √† votre story" pendant le live</p>
                    <p>3. Le live sera visible dans vos stories pendant 24h</p>
                    <a href="https://help.instagram.com/196801932981584" target="_blank" class="social-link-btn">Guide Instagram</a>
                </div>

                <!-- Facebook -->
                <div class="social-platform">
                    <h3>üë• Facebook</h3>
                    <p><strong>Live / Stories :</strong></p>
                    <p>1. Cr√©ez une publication "Live"</p>
                    <p>2. Partagez le live directement depuis OBS</p>
                    <p>3. Utilisez Facebook Live Producer pour la diffusion</p>
                    <a href="https://www.facebook.com/live/producer" target="_blank" class="social-link-btn">Facebook Live Producer</a>
                </div>

                <!-- TikTok -->
                <div class="social-platform">
                    <h3>üéµ TikTok</h3>
                    <p><strong>Live Streaming :</strong></p>
                    <p>1. Ouvrez TikTok et cr√©ez un Live</p>
                    <p>2. Utilisez un outil de streaming (OBS avec plugin)</p>
                    <p>3. Configurez la cl√© de stream dans OBS</p>
                    <a href="https://support.tiktok.com/fr/using-tiktok/starting-out-with-live" target="_blank" class="social-link-btn">Guide TikTok Live</a>
                </div>

                <!-- YouTube -->
                <div class="social-platform">
                    <h3>‚ñ∂Ô∏è YouTube</h3>
                    <p><strong>Streaming :</strong></p>
                    <p>1. Cr√©ez un live event sur YouTube Studio</p>
                    <p>2. R√©cup√©rez la cl√© de stream</p>
                    <p>3. Configurez OBS avec cette cl√©</p>
                    <a href="https://studio.youtube.com" target="_blank" class="social-link-btn">YouTube Studio</a>
                </div>
            </div>

            <div class="social-guide">
                <h3>üéØ Multi-diffusion (simultan√©e sur plusieurs plateformes)</h3>
                <p>Pour diffuser en simultan√© sur plusieurs plateformes, vous pouvez utiliser :</p>
                <ul>
                    <li><strong>Restream.io</strong> : Service de multi-diffusion professionnel</li>
                    <li><strong>OBS avec plugins</strong> : RTMP vers plusieurs destinations</li>
                    <li><strong>Streamlabs</strong> : Solution tout-en-un pour le streaming</li>
                    <li><strong>XSplit</strong> : Alternative √† OBS avec multi-diffusion</li>
                </ul>
                <a href="https://restream.io" target="_blank" class="social-link-btn">Essayer Restream.io</a>
            </div>

            <div class="social-guide" style="margin-top: 20px;">
                <h3>üí° Conseils pour le partage</h3>
                <ul>
                    <li>Ajoutez des hashtags pertinents (#volley #sport #live)</li>
                    <li>Planifiez vos lives √† l'avance pour informer votre audience</li>
                    <li>Interagissez avec les commentaires pendant le live</li>
                    <li>Partagez le replay apr√®s le match</li>
                    <li>Utilisez des vignettes attrayantes pour annoncer le live</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>

